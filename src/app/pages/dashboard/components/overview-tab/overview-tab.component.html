<div class="overview-container">
  <div *ngIf="isLoading" class="loading-state">
    <div class="skeleton-card"></div>
    <div class="skeleton-card"></div>
    <div class="skeleton-card"></div>
  </div>

  <div *ngIf="!isLoading && dashboardData" class="overview-content">
    <!-- Top Row: Balance, Income, Expense -->
    <div class="top-row">
      <!-- Main Balance Card -->
      <div class="balance-card">
        <div class="balance-label">Total balance</div>
        <div class="balance-amount">{{formatNumber(dashboardData.totalBalance)}}<sup>$</sup></div>
        <div class="balance-change">
          <span *ngIf="dashboardData.lastMonthNetRevenue >= 0">+{{formatNumber(dashboardData.lastMonthNetRevenue)}}</span>
          <span *ngIf="dashboardData.lastMonthNetRevenue < 0">-{{formatNumber(-dashboardData.lastMonthNetRevenue)}}</span>
          <sup>$</sup> revenue from last month
        </div>
        <div class="balance-actions">
          <button class="btn-transfer">Transfer</button>
          <button class="btn-topup">Top Up</button>
        </div>
      </div>

      <!-- Income Card -->
      <div class="stat-card stat-income">
        <div class="stat-label">Income</div>
        <div class="stat-value">+{{formatNumber(selectedMonthlyIncome || 0)}}<sup>$</sup></div>
        <div class="stat-footer">
          <span>This month's income</span>
          <span class="badge-up"></span>
        </div>
      </div>

      <!-- Expense Card -->
      <div class="stat-card stat-expense">
        <div class="stat-label">Expense</div>
        <div class="stat-value">-{{formatNumber(selectedMonthlyExpense || 0)}}<sup>$</sup></div>
        <div class="stat-footer">
          <span>This month's expense</span>
          <span class="badge-down"></span>
        </div>
      </div>
    </div>

    <!-- Bottom Row -->
    <div class="bottom-row">
      <!-- Revenue Chart -->
      <div class="chart-card">
        <div class="chart-header">
          <h3>Revenue flow</h3>
          <div class="controls">
            <button class="active">Monthly</button>
            <button class="refresh">â†»</button>
          </div>
        </div>
        <div class="bar-chart">
          <div
            class="bar"
            *ngFor="let item of dashboardData.revenueFlow; let last = last"
            [class.active]="last"
            [style.height.%]="item.netPercent || 0"
            (click)="onRevenueBarClick(item)"
          >
            <span class="bar-label">{{item.label}}</span>
            <span class="bar-value">{{formatSignedAmount(item.net)}}$</span>
          </div>
        </div>
      </div>

      <!-- Expense Split -->
      <div class="chart-card">
        <div class="chart-header">
          <h3>Expense split</h3>
          <select [value]="selectedMonthKey" (change)="onMonthChange($event)">
            <option *ngFor="let m of monthOptions" [value]="m.value">{{m.label}}</option>
          </select>
        </div>
        <div class="donut-container">
          <div class="donut-chart">
            <svg viewBox="0 0 200 200">
              <circle
                *ngFor="let seg of donutSegments"
                cx="100"
                cy="100"
                r="80"
                fill="none"
                [attr.stroke]="seg.color"
                stroke-width="30"
                [attr.stroke-dasharray]="seg.dashArray"
                [attr.stroke-dashoffset]="seg.dashOffset"
                transform="rotate(-90 100 100)"
              ></circle>
            </svg>
            <div class="donut-center">
              <div>Total</div>
              <div class="donut-value">{{formatNumber(selectedMonthlyExpense || 0)}}<sup>$</sup></div>
            </div>
          </div>
          <div class="legend">
            <div class="legend-row" *ngFor="let item of selectedExpenseSplit">
              <div>
                <span class="dot" [style.backgroundColor]="getCategoryColor(item.category)"></span>
                {{item.category}}
                <span>{{formatNumber(item.amount)}}$ ({{item.percentage}}%)</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
